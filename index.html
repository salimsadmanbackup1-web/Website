<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SADMAN üíû TASNIM ‚Äî Private Universe</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #ff4d6d; --secondary: #ff85a1; --bg: #fff0f3; --glass: rgba(255, 255, 255, 0.96); }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); min-height: 100vh; color: #444; overflow-x: hidden; }
        
        header { text-align:center; padding:30px 20px; color:white; text-shadow: 0 2px 10px rgba(0,0,0,0.1); position: relative; }
        
        .counter-container { background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); border-radius: 20px; padding: 12px 20px; margin: 10px auto; display: inline-block; border: 1px solid rgba(255,255,255,0.4); box-shadow: 0 8px 20px rgba(255, 77, 109, 0.2); }
        .counter-title { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px; opacity: 0.9; }
        .counter-display { font-size: 1.1rem; font-weight: 600; letter-spacing: 0.5px; }

        .nav-trigger { background: var(--glass); color: var(--primary); padding: 10px 25px; border-radius: 50px; font-weight: 600; cursor: pointer; display: inline-block; margin-top: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }

        .side-menu { position: fixed; top: 0; left: -280px; width: 280px; height: 100%; background: var(--glass); z-index: 1000; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1); padding: 40px 20px; box-shadow: 10px 0 30px rgba(0,0,0,0.1); }
        .side-menu.active { left: 0; }
        .menu-item { padding: 15px; margin-bottom: 12px; border-radius: 15px; background: white; font-weight: 600; color: var(--primary); display: flex; align-items: center; gap: 10px; cursor: pointer; transition: 0.3s; border: 1px solid #ffeef2; }
        .menu-item:hover { background: var(--bg); transform: translateX(5px); }
        .overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.4); z-index: 999; display:none; backdrop-filter: blur(2px); }

        .container { max-width:900px; margin:auto; padding:15px; padding-bottom: 80px; }
        .card { background: var(--glass); backdrop-filter: blur(10px); border-radius: 25px; padding: 25px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(255, 77, 109, 0.1); border: 1px solid rgba(255,255,255,0.5); }
        .hidden { display:none !important; }
        
        /* Chat UI */
        #chatDisplay { height: 350px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; padding: 15px; background: #fff8f9; border-radius: 20px; border: 1px solid #fce4ec; margin-bottom: 15px; }
        .msg { max-width: 75%; padding: 8px 14px; border-radius: 15px; font-size: 0.85rem; line-height: 1.4; position: relative; }
        .msg-sent { align-self: flex-end; background: var(--primary); color: white; border-bottom-right-radius: 2px; }
        .msg-rec { align-self: flex-start; background: white; color: #444; border-bottom-left-radius: 2px; border: 1px solid #eee; }

        /* Canvas & Mood Selection */
        #canvasBox { border: 2px dashed var(--primary); border-radius: 20px; background: white; touch-action: none; width: 100%; height: 350px; cursor: crosshair; }
        
        .color-picker { display: flex; gap: 10px; margin-bottom: 15px; justify-content: center; }
        .color-circle { width: 30px; height: 30px; border-radius: 50%; border: 2px solid #fff; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        .emoji-box { font-size: 2.5rem; cursor: pointer; transition: 0.3s; padding: 5px; border-radius: 10px; border: 2px solid transparent; }
        .emoji-box:hover { background: rgba(255, 77, 109, 0.1); }
        .emoji-box.selected { border-color: var(--primary); background: rgba(255, 77, 109, 0.05); transform: scale(1.1); }

        .memory-grid { display:grid; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:20px; }
        .memory-item { background: white; border-radius: 25px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        .memory-item img { width: 100%; height: 250px; object-fit: cover; }
        .mem-footer { font-size: 0.7rem; color: #aaa; margin-top: 10px; padding: 10px 15px; border-top: 1px solid #f9f9f9; display: flex; justify-content: space-between; align-items: center; }
        
        input, textarea { width: 100%; padding: 12px; margin-top: 10px; border-radius: 12px; border: 1px solid #eee; outline: none; background: #fafafa; }
        .btn { padding: 10px 18px; border-radius: 12px; border: none; cursor: pointer; font-weight: 600; font-size: 0.8rem; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; width: 100%; margin-top: 10px; }
        .btn-primary:active { transform: scale(0.98); }

        .mood-row { display:flex; justify-content:space-between; align-items: center; padding:12px; background:white; border-radius:15px; margin-bottom:8px; border-left: 5px solid var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
        .credit-text { text-align: center; margin: 30px 0; font-size: 0.8rem; color: #fff; font-weight: 600; }
        #ytPlayer { display: none; }
    </style>
</head>
<body>

<header>
    <h1>SADMAN üíù TASNIM</h1>
    <div id="timerContainer" class="counter-container hidden">
        <div class="counter-title">Our Love Journey begain Feb 13, 2025</div>
        <div class="counter-display" id="loveCounter">00 Days 00 Hours 00 Minutes 00 Seconds</div>
    </div>
    <br>
    <div class="nav-trigger hidden" id="navTrigger" onclick="toggleMenu(true)">Screct Access ‚ú®</div>
</header>

<div class="overlay" id="overlay" onclick="toggleMenu(false)"></div>
<div class="side-menu" id="sideMenu">
    <h2 style="color:var(--primary); margin-bottom:20px; padding-left:10px;">Menu</h2>
    <div class="menu-item" onclick="showSection('viewMemories')">üè† Memories Home</div>
    <div class="menu-item" onclick="showSection('chatTab')">üí¨ Secret Chat</div>
    <div class="menu-item" onclick="showSection('moodTab')">‚ú® Daily Mood</div>
    <div class="menu-item" onclick="showSection('drawTab')">üé® Drawing Pad</div>
    <div class="menu-item" onclick="showSection('addForm')">üì∏ Add New Memory</div>
    <div class="menu-item" onclick="showSection('settings')">‚öôÔ∏è Settings</div>
    <div class="menu-item" style="margin-top:20px; color: #888;" onclick="logout()">‚úï Logout</div>
</div>

<div id="ytPlayer"></div>
<audio id="bgMusic" loop></audio>

<div class="container" id="loginSection">
    <div class="card" id="loginBox" style="max-width: 400px; margin: auto;">
        <h2 style="text-align: center; margin-bottom:15px;">üîê Private World</h2>
        <input type="text" id="username" placeholder="Username">
        <input type="password" id="password" placeholder="Password">
        <button class="btn btn-primary" onclick="login()">Enter Our World</button>
        <p style="text-align:center; font-size:0.8rem; margin-top:10px; cursor:pointer; color:var(--primary)" onclick="toggleForgot(true)">Lost Password?</p>
    </div>
    <div class="card hidden" id="forgotBox" style="max-width: 400px; margin: auto;">
        <h3>reset Pass</h3>
        <input type="password" id="forgotMaster" placeholder="Master Key">
        <input type="text" id="newU" placeholder="New Username">
        <input type="password" id="newP" placeholder="New Password">
        <button class="btn btn-primary" onclick="resetLogin()">Reset Now</button>
        <button class="btn" style="width:100%; margin-top:5px;" onclick="toggleForgot(false)">Back</button>
    </div>
    <div class="credit-text">Created with love for Tasnim ‚ù§Ô∏è</div>
</div>

<div class="container hidden" id="appSection">
    
    <div id="viewMemories" class="section">
        <div class="memory-grid" id="memoryGrid"></div>
    </div>

    <div id="chatTab" class="section hidden">
        <div class="card">
            <h3>üí¨ Secret Chat</h3>
            <div id="chatDisplay"></div>
            <div style="display:flex; gap:8px;">
                <input type="text" id="chatInput" placeholder="Message..." onkeypress="if(event.key==='Enter') sendChat()">
                <button class="btn btn-primary" style="width:80px; margin-top:10px;" onclick="sendChat()">Send</button>
            </div>
        </div>
    </div>

    <div id="moodTab" class="section hidden">
        <div class="card">
            <h3 style="text-align:center">Current Mood üß∏</h3>
            <div id="emojiPalette" style="display:flex; justify-content:space-around; margin:15px 0; cursor:pointer;">
                <span class="emoji-box" onclick="selectEmoji('üò≠', this)">üò≠</span>
                <span class="emoji-box" onclick="selectEmoji('üòõ', this)">üòõ</span>
                <span class="emoji-box" onclick="selectEmoji('üò§', this)">üò§</span>
                <span class="emoji-box" onclick="selectEmoji('üíû', this)">üíû</span>
                <span class="emoji-box" onclick="selectEmoji('üë∫', this)">üë∫</span>
            </div>
            <input type="text" id="moodNote" placeholder="A brief note about this vibe...">
            <button class="btn btn-primary" onclick="saveMood()">Save Current Vibe</button>
            <div id="moodHistory" style="margin-top:20px;"></div>
        </div>
    </div>

    <div id="drawTab" class="section hidden">
        <div class="card">
            <h3>üé® Sketch Pad</h3>
            <div class="color-picker">
                <div class="color-circle" style="background: #ff4d6d" onclick="changeColor('#ff4d6d')"></div>
                <div class="color-circle" style="background: #000000" onclick="changeColor('#000000')"></div>
                <div class="color-circle" style="background: #2196F3" onclick="changeColor('#2196F3')"></div>
                <div class="color-circle" style="background: #4CAF50" onclick="changeColor('#4CAF50')"></div>
                <input type="color" onchange="changeColor(this.value)" style="width:30px; height:30px; border:none; background:none;">
            </div>
            <canvas id="canvasBox"></canvas>
            <button class="btn btn-primary" onclick="saveDrawing()">Save to Home ‚ù§Ô∏è</button>
            <button class="btn" style="width:100%; margin-top:5px; background:#ddd;" onclick="clearCanvas()">Clear Board</button>
        </div>
    </div>

    <div id="addForm" class="section hidden">
        <div class="card">
            <h3>üì∏ New Memory</h3>
            <div style="background: #e3fcef; color: #219653; font-size: 0.75rem; padding: 4px 10px; border-radius: 10px; font-weight: 600; display: inline-block; margin-bottom: 5px;">‚úì Photo Resize Engine Active</div>
            <input type="file" id="photoInput" accept="image/*">
            <textarea id="memoryText" placeholder="The story behind this photo..."></textarea>
            <button class="btn btn-primary" onclick="handleSave()">Save Memory ‚ù§Ô∏è</button>
        </div>
    </div>

    <div id="settings" class="section hidden">
        <div class="card">
            <h3>‚öôÔ∏è Settings & Security</h3>
            <div style="margin-top:15px;">
                <p style="font-size:0.8rem; font-weight:600; color:var(--primary);">Update Master Key:</p>
                <input type="password" id="oldMK" placeholder="Current Master Key">
                <input type="password" id="newMK" placeholder="New Master Key">
                <button class="btn btn-primary" onclick="updateMaster()">Update Master Key</button>
            </div>
            <hr style="margin:20px 0; opacity:0.1">
            <div>
                <p style="font-size:0.8rem; font-weight:600; color:var(--primary);">Update Login (User/Pass):</p>
                <input type="password" id="authMK" placeholder="Master Key to Authenticate">
                <input type="text" id="newU" placeholder="New Username">
                <input type="password" id="newP" placeholder="New Password">
                <button class="btn btn-primary" onclick="updateLogin()">Update Access Credentials</button>
            </div>
        </div>
    </div>

    <div class="credit-text">Created with love for Tasnim ‚ù§Ô∏è</div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.youtube.com/iframe_api"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCTAIWwavQ9rPL2DjlbMvYPAHlZUkDphl8",
        authDomain: "testing2-ef294.firebaseapp.com",
        projectId: "testing2-ef294",
        storageBucket: "testing2-ef294.firebasestorage.app",
        appId: "1:101601598928:web:a612b801372f4c701eedd5"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let ADMIN_SECRET = "salim sadman shoron";
    let loginData = { user: "turuturu", pass: "turuturu" };
    let currentUser = localStorage.getItem('loveUser') || "";
    let selectedMoodEmoji = "";

    function toggleMenu(show) {
        document.getElementById('sideMenu').classList.toggle('active', show);
        document.getElementById('overlay').style.display = show ? 'block' : 'none';
    }

    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        toggleMenu(false);
        if(id === 'drawTab') setTimeout(initCanvas, 100);
    }

    async function syncConfig() {
        const mDoc = await db.collection('config').doc('master').get();
        if(mDoc.exists) ADMIN_SECRET = mDoc.data().key;
        const lDoc = await db.collection('config').doc('login').get();
        if(lDoc.exists) loginData = lDoc.data();
        const musDoc = await db.collection('config').doc('music').get();
        if(musDoc.exists) playMusic(musDoc.data().url);
    }

    function login() {
        const u = document.getElementById('username').value.trim();
        const p = document.getElementById('password').value.trim();
        if(u === loginData.user && p === loginData.pass) {
            localStorage.setItem('loveLogin', 'yes');
            localStorage.setItem('loveUser', u);
            location.reload();
        } else alert('Unauthorized access.');
    }

    if(localStorage.getItem('loveLogin') === 'yes') {
        document.getElementById('loginSection').classList.add('hidden');
        document.getElementById('appSection').classList.remove('hidden');
        document.getElementById('timerContainer').classList.remove('hidden');
        document.getElementById('navTrigger').classList.remove('hidden');
        syncConfig(); loadMemories(); loadMoods(); listenChat();
    }

    // Chat Logic Fixed (Bubble Style with delete)
    function listenChat() {
        db.collection('chats').orderBy('time', 'asc').limitToLast(40).onSnapshot(snap => {
            const box = document.getElementById('chatDisplay'); box.innerHTML = "";
            snap.forEach(doc => {
                const c = doc.data();
                const isMe = c.user === currentUser;
                box.innerHTML += `<div class="msg-wrap ${isMe ? 'sent-wrap' : 'received-wrap'}" onclick="delMsg('${doc.id}')"><div class="msg ${isMe ? 'msg-sent' : 'msg-rec'}">${c.text}</div></div>`;
            });
            box.scrollTop = box.scrollHeight;
        });
    }
    async function sendChat() {
        const inp = document.getElementById('chatInput');
        if(!inp.value.trim()) return;
        await db.collection('chats').add({ user: currentUser, text: inp.value, time: Date.now() });
        inp.value = "";
    }
    async function delMsg(id) { if(prompt("Master Key:") === ADMIN_SECRET) await db.collection('chats').doc(id).delete(); }

    // Mood Logic Fixed (Highlighting & Saving with Note)
    function selectEmoji(emoji, el) {
        selectedMoodEmoji = emoji;
        document.querySelectorAll('.emoji-box').forEach(b => b.classList.remove('selected'));
        el.classList.add('selected');
    }
    async function saveMood() {
        const note = document.getElementById('moodNote').value;
        if(!selectedMoodEmoji) return alert("Select emoji!");
        await db.collection('moods').add({ emoji: selectedMoodEmoji, note, time: Date.now() });
        document.getElementById('moodNote').value = ""; selectedMoodEmoji = "";
        document.querySelectorAll('.emoji-box').forEach(b => b.classList.remove('selected'));
        loadMoods();
    }
    async function loadMoods() {
        const h = document.getElementById('moodHistory');
        const snap = await db.collection('moods').orderBy('time', 'desc').limit(15).get();
        h.innerHTML = "";
        snap.forEach(doc => {
            const d = doc.data();
            h.innerHTML += `<div class="mood-row"><span>${d.emoji} <b>${d.note}</b></span><span onclick="delMood('${doc.id}')" style="color:#ccc;">‚úï</span></div>`;
        });
    }
    async function delMood(id) { if(prompt("Master Key:") === ADMIN_SECRET) { await db.collection('moods').doc(id).delete(); loadMoods(); } }

    // Memories & Resizing (Persistent Dates)
    async function handleSave() {
        const file = document.getElementById('photoInput').files[0];
        const text = document.getElementById('memoryText').value;
        if(!file || !text) return alert("Photo & story required!");
        const reader = new FileReader(); reader.readAsDataURL(file);
        reader.onload = (e) => {
            const img = new Image(); img.src = e.target.result;
            img.onload = async () => {
                const c = document.createElement('canvas');
                let w = img.width, h = img.height, max = 1000;
                if(w > max) { h *= max/w; w = max; }
                c.width = w; c.height = h;
                c.getContext('2d').drawImage(img, 0, 0, w, h);
                await db.collection('memories').add({ text, img: c.toDataURL('image/jpeg', 0.65), time: Date.now() });
                location.reload();
            }
        }
    }
    async function loadMemories() {
        const grid = document.getElementById('memoryGrid');
        const snap = await db.collection('memories').orderBy('time', 'desc').get();
        grid.innerHTML = "";
        snap.forEach(doc => {
            const m = doc.data();
            const dateStr = new Date(m.time).toLocaleString('en-GB', { day:'numeric', month:'short', year:'numeric', hour:'2-digit', minute:'2-digit' });
            grid.innerHTML += `<div class="memory-item"><img src="${m.img}"><div style="padding:15px;"><p>${m.text}</p><p style="font-size:0.7rem; color:#aaa; margin-top:5px;">Added: ${dateStr}</p><div style="margin-top:10px;"><button class="btn" style="background:#eee; font-size:0.7rem;" onclick="editMem('${doc.id}', '${m.text}')">Edit</button><button class="btn" style="color:red; font-size:0.7rem;" onclick="delMem('${doc.id}')">Delete</button></div></div></div>`;
        });
    }
    async function editMem(id, currentText) {
        // Edit without password as per user request
        const newText = prompt("Edit Story:", currentText);
        if(newText) {
            await db.collection('memories').doc(id).update({ text: newText });
            loadMemories();
        }
    }
    async function delMem(id) { if(prompt("Master Key:") === ADMIN_SECRET) { await db.collection('memories').doc(id).delete(); loadMemories(); } }

    // Drawing Pad Logic Fixed (Touch & Mouse Support with Multi-color)
    const canvas = document.getElementById('canvasBox');
    const ctx = canvas.getContext('2d');
    let drawing = false, currentColor = "#ff4d6d";

    function initCanvas() {
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;
        ctx.strokeStyle = currentColor; ctx.lineWidth = 4; ctx.lineCap = "round";
    }
    function changeColor(c) { currentColor = c; }

    canvas.addEventListener('mousedown', startDraw); canvas.addEventListener('mouseup', stopDraw); canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startDraw(e.touches[0]); });
    canvas.addEventListener('touchend', stopDraw); canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e.touches[0]); });

    function startDraw(e) { drawing = true; draw(e); }
    function stopDraw() { drawing = false; ctx.beginPath(); }
    function draw(e) {
        if(!drawing) return;
        const rect = canvas.getBoundingClientRect();
        ctx.strokeStyle = currentColor;
        ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top); ctx.stroke();
    }
    async function saveDrawing() {
        const data = canvas.toDataURL();
        await db.collection('sketches').add({ img: data, time: Date.now() });
        alert("Sketch Saved to Memories!"); showSection('viewMemories'); loadMemories();
    }
    function clearCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); }

    // Other extras
    setInterval(() => {
        const diff = new Date() - new Date("2025-02-13T11:14:00");
        const d = Math.floor(diff/86400000), h = Math.floor((diff%86400000)/3600000), m = Math.floor((diff%3600000)/60000), s = Math.floor((diff%60000)/1000);
        document.getElementById('loveCounter').innerText = `${d} Days ${h} Hours ${m} Minutes ${s} Seconds`;
    }, 1000);
    
    // Auth Settings Fixed
    async function updateMaster() {
        const old = document.getElementById('oldMK').value;
        const next = document.getElementById('newMK').value;
        if(old !== ADMIN_SECRET) return alert("Wrong Key!");
        await db.collection('config').doc('master').set({ key: next });
        alert("Done!"); location.reload();
    }
    async function updateLogin() {
        if(document.getElementById('authMK').value !== ADMIN_SECRET) return alert("Wrong Key!");
        await db.collection('config').doc('login').set({ user: document.getElementById('newU').value, pass: document.getElementById('newP').value });
        alert("Done! Logging out..."); logout();
    }

    function toggleForgot(s) { document.getElementById('loginBox').classList.toggle('hidden', s); document.getElementById('forgotBox').classList.toggle('hidden', !s); }
    async function resetLogin() {
        if(document.getElementById('forgotMaster').value === ADMIN_SECRET) {
            await db.collection('config').doc('login').set({ user: document.getElementById('newU').value, pass: document.getElementById('newP').value });
            alert("Credentials updated."); location.reload();
        } else alert("Invalid Key.");
    }
    function logout() { localStorage.clear(); location.reload(); }
    function playMusic(url) {
        if(!url) return;
        if(url.includes('youtube')) {
            const id = url.split('v=')[1]?.split('&')[0];
            new YT.Player('ytPlayer', { height: '0', width: '0', videoId: id, events: { 'onReady': (e) => e.target.playVideo() } });
        } else {
            const a = document.getElementById('bgMusic'); a.src = url; a.play().catch(()=>{});
        }
    }
</script>
</body>
</html>
