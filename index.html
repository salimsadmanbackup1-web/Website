<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SADMAN üíû TASNIM ‚Äî Private Universe</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #ff4d6d; --secondary: #ff85a1; --bg: #fff0f3; --glass: rgba(255, 255, 255, 0.96); }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Poppins', sans-serif; background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); min-height: 100vh; color: #444; overflow-x: hidden; }
        header { text-align:center; padding:30px 20px; color:white; text-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .counter-container { background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); border-radius: 20px; padding: 15px 20px; margin: 10px auto; display: inline-block; border: 1px solid rgba(255,255,255,0.4); }
        .counter-display { font-size: 1.1rem; font-weight: 600; }
        .love-start-text { font-size: 0.75rem; opacity: 0.95; margin-top: 8px; font-weight: 400; font-style: italic; border-top: 1px solid rgba(255,255,255,0.3); padding-top: 5px; }
        .nav-trigger { background: var(--glass); color: var(--primary); padding: 10px 25px; border-radius: 50px; font-weight: 600; cursor: pointer; display: inline-block; margin-top: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .side-menu { position: fixed; top: 0; left: -280px; width: 280px; height: 100%; background: var(--glass); z-index: 1000; transition: 0.4s; padding: 40px 20px; box-shadow: 10px 0 30px rgba(0,0,0,0.1); }
        .side-menu.active { left: 0; }
        .menu-item { padding: 15px; margin-bottom: 12px; border-radius: 15px; background: white; font-weight: 600; color: var(--primary); display: flex; align-items: center; gap: 10px; cursor: pointer; border: 1px solid #ffeef2; }
        .overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.4); z-index: 999; display:none; backdrop-filter: blur(2px); }
        .container { max-width:900px; margin:auto; padding:15px; padding-bottom: 80px; }
        .card { background: var(--glass); backdrop-filter: blur(10px); border-radius: 25px; padding: 25px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(255, 77, 109, 0.1); }
        .hidden { display:none !important; }
        
        .memory-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .memory-item { background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.05); display: flex; flex-direction: column; }
        .memory-item img { width: 100%; height: 220px; object-fit: cover; background: #eee; }
        .memory-content { padding: 15px; flex-grow: 1; display: flex; flex-direction: column; justify-content: space-between; }

        #chatDisplay { height: 350px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; padding: 15px; background: #fff8f9; border-radius: 20px; margin-bottom: 15px; }
        .msg-wrap { display: flex; width: 100%; align-items: center; gap: 8px; }
        .sent-wrap { flex-direction: row-reverse; }
        .msg { max-width: 70%; padding: 8px 14px; border-radius: 15px; font-size: 0.85rem; }
        .msg-sent { background: var(--primary); color: white; }
        .msg-rec { background: white; border: 1px solid #eee; }
        
        #canvasBox { border: 2px dashed var(--primary); border-radius: 20px; background: white; touch-action: none; width: 100%; height: 400px; cursor: crosshair; }
        .color-picker-container { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; padding: 5px; background: #fff; border-radius: 12px; }
        #strokeColor { width: 40px; height: 40px; border: none; border-radius: 50%; cursor: pointer; background: none; }
        
        .emoji-box { font-size: 2.5rem; cursor: pointer; padding: 10px; transition: 0.3s; filter: grayscale(100%); opacity: 0.6; }
        .emoji-box.selected { filter: grayscale(0%); opacity: 1; transform: scale(1.2); background: rgba(255, 77, 109, 0.1); border-radius: 15px; }
        .mood-log-item { padding: 12px; background: white; border-radius: 15px; margin-top: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 3px 10px rgba(0,0,0,0.05); border-left: 4px solid var(--primary); }

        input, textarea { width: 100%; padding: 12px; margin-top: 10px; border-radius: 12px; border: 1px solid #eee; outline: none; }
        .btn { padding: 10px 18px; border-radius: 12px; border: none; cursor: pointer; font-weight: 600; }
        .btn-primary { background: var(--primary); color: white; width: 100%; margin-top: 10px; }
        .credit-text { text-align: center; margin: 30px 0; font-size: 1rem; font-weight: 600; color: #fff; text-shadow: 1px 1px 5px rgba(0,0,0,0.2); }
    </style>
</head>
<body>

<header>
    <h1>SADMAN üíù TASNIM</h1>
    <div id="timerContainer" class="counter-container hidden">
        <div class="counter-display" id="loveCounter">Loading...</div>
        <div class="love-start-text">Our Love Universe started on 13 February 2025 ‚ù§Ô∏è</div>
    </div>
    <br>
    <div class="nav-trigger hidden" id="navTrigger" onclick="toggleMenu(true)">Secret Access ‚ú®</div>
</header>

<div class="overlay" id="overlay" onclick="toggleMenu(false)"></div>
<div class="side-menu" id="sideMenu">
    <div class="menu-item" onclick="showSection('viewMemories')">üè† Memories Home</div>
    <div class="menu-item" onclick="showSection('chatTab')">üí¨ Private Chat</div>
    <div class="menu-item" onclick="showSection('moodTab')">‚ú® Daily Mood</div>
    <div class="menu-item" onclick="showSection('drawTab')">üé® Drawing Pad</div>
    <div class="menu-item" onclick="showSection('gameCenter')">üéÆ Play Zone</div>
    <div class="menu-item" onclick="showSection('addForm')">üì∏ New Memory</div>
    <div class="menu-item" onclick="showSection('settings')">‚öôÔ∏è Settings</div>
    <div class="menu-item" onclick="logout()">‚úï Logout</div>
</div>

<div class="container" id="loginSection">
    <div class="card" style="max-width: 400px; margin: auto;">
        <h2 style="text-align:center; margin-bottom:15px;">üîê Private World</h2>
        <input type="text" id="username" placeholder="Username">
        <input type="password" id="password" placeholder="Password">
        <button class="btn btn-primary" onclick="login()">Enter</button>
        <p style="text-align:center; font-size:0.8rem; margin-top:15px; color:var(--primary); cursor:pointer;" onclick="forgetPass()">Lost Password?</p>
    </div>
    <div class="credit-text">Made with love for Tasnim ‚ù§Ô∏è</div>
</div>

<div class="container hidden" id="appSection">
    <div id="viewMemories" class="section">
        <div class="memory-grid" id="memoryGrid"></div>
    </div>

    <div id="chatTab" class="section hidden">
        <div class="card">
            <h3>üí¨ Private Chat</h3>
            <div id="chatDisplay"></div>
            <div style="display:flex; gap:8px;">
                <input type="text" id="chatInput" placeholder="Message..." onkeypress="if(event.key==='Enter') sendChat()">
                <button class="btn btn-primary" style="width:80px;" onclick="sendChat()">Send</button>
            </div>
        </div>
    </div>

    <div id="moodTab" class="section hidden">
        <div class="card">
            <h3>Daily Mood üß∏</h3>
            <div style="display:flex; justify-content:space-around; margin:15px 0;">
                <span class="emoji-box" onclick="selectEmoji('üò≠', this)">üò≠</span>
                <span class="emoji-box" onclick="selectEmoji('üòõ', this)">üòõ</span>
                <span class="emoji-box" onclick="selectEmoji('üò§', this)">üò§</span>
                <span class="emoji-box" onclick="selectEmoji('üíû', this)">üíû</span>
            </div>
            <input type="text" id="moodNote" placeholder="How are you feeling?">
            <button class="btn btn-primary" onclick="saveMood()">Save Vibe</button>
            <div id="moodDisplay" style="margin-top:20px; border-top:1px solid #eee; padding-top:15px;"></div>
        </div>
    </div>

    <div id="drawTab" class="section hidden">
        <div class="card">
            <div class="color-picker-container">
                <label style="font-weight:600; font-size:0.8rem;">Pick Color:</label>
                <input type="color" id="strokeColor" value="#ff4d6d">
            </div>
            <canvas id="canvasBox"></canvas>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <button class="btn btn-primary" style="flex:2" onclick="saveDrawing()">Save Sketch</button>
                <button class="btn" style="flex:1; background:#ddd;" onclick="clearCanvas()">Clear</button>
            </div>
            <div id="sketchGallery" style="margin-top:20px; display:grid; grid-template-columns:repeat(2,1fr); gap:10px;"></div>
        </div>
    </div>

    <div id="gameCenter" class="section hidden">
        <div class="card">
            <h3>üéÆ Tic Tac Toe</h3>
            <div id="tttGrid" style="display:grid; grid-template-columns:repeat(3,1fr); gap:10px; max-width:300px; margin:20px auto;">
                <div class="game-cell" style="background:white; height:80px; border-radius:15px; display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:bold; color:var(--primary); box-shadow:0 4px 10px rgba(0,0,0,0.05);" onclick="playOnlineTTT(0)"></div>
                <div class="game-cell" style="background:white; height:80px; border-radius:15px; display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:bold; color:var(--primary); box-shadow:0 4px 10px rgba(0,0,0,0.05);" onclick="playOnlineTTT(1)"></div>
                <div class="game-cell" style="background:white; height:80px; border-radius:15px; display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:bold; color:var(--primary); box-shadow:0 4px 10px rgba(0,0,0,0.05);" onclick="playOnlineTTT(2)"></div>
                <div class="game-cell" style="background:white; height:80px; border-radius:15px; display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:bold; color:var(--primary); box-shadow:0 4px 10px rgba(0,0,0,0.05);" onclick="playOnlineTTT(3)"></div>
                <div class="game-cell" style="background:white; height:80px; border-radius:15px; display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:bold; color:var(--primary); box-shadow:0 4px 10px rgba(0,0,0,0.05);" onclick="playOnlineTTT(4)"></div>
                <div class="game-cell" style="background:white; height:80px; border-radius:15px; display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:bold; color:var(--primary); box-shadow:0 4px 10px rgba(0,0,0,0.05);" onclick="playOnlineTTT(5)"></div>
                <div class="game-cell" style="background:white; height:80px; border-radius:15px; display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:bold; color:var(--primary); box-shadow:0 4px 10px rgba(0,0,0,0.05);" onclick="playOnlineTTT(6)"></div>
                <div class="game-cell" style="background:white; height:80px; border-radius:15px; display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:bold; color:var(--primary); box-shadow:0 4px 10px rgba(0,0,0,0.05);" onclick="playOnlineTTT(7)"></div>
                <div class="game-cell" style="background:white; height:80px; border-radius:15px; display:flex; align-items:center; justify-content:center; font-size:2rem; font-weight:bold; color:var(--primary); box-shadow:0 4px 10px rgba(0,0,0,0.05);" onclick="playOnlineTTT(8)"></div>
            </div>
            <button class="btn btn-primary" onclick="resetOnlineTTT()">Reset Match</button>
        </div>
    </div>

    <div id="addForm" class="section hidden">
        <div class="card">
            <h3>üì∏ New Memory</h3>
            <input type="file" id="photoInput" accept="image/*">
            <p style="text-align:center; font-size:0.75rem; color:var(--primary); margin:10px 0; font-weight:600; font-style: italic;">(Resize On)</p>
            <textarea id="memoryText" placeholder="Write the story..."></textarea>
            <button class="btn btn-primary" onclick="handleSave()">Store Memory ‚ù§Ô∏è</button>
        </div>
    </div>

    <div id="settings" class="section hidden">
        <div class="card">
            <h3>‚öôÔ∏è Settings</h3>
            <input type="password" id="authMK" placeholder="Master Key">
            <input type="text" id="setNewU" placeholder="New Username">
            <input type="password" id="setNewP" placeholder="New Password">
            <button class="btn btn-primary" onclick="updateLogin()">Update Login</button>
            <hr style="margin:20px 0; opacity:0.1">
            <input type="password" id="oldMK" placeholder="Old Master Key">
            <input type="password" id="newMK" placeholder="New Master Key">
            <button class="btn btn-primary" onclick="updateMaster()">Update Master Key</button>
        </div>
    </div>

    <div class="credit-text">Made with love for Tasnim ‚ù§Ô∏è</div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyCTAIWwavQ9rPL2DjlbMvYPAHlZUkDphl8",
        authDomain: "testing2-ef294.firebaseapp.com",
        projectId: "testing2-ef294",
        storageBucket: "testing2-ef294.firebasestorage.app",
        appId: "1:101601598928:web:a612b801372f4c701eedd5"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    let ADMIN_SECRET = "salim sadman shoron";
    let loginData = { user: "turuturu", pass: "turuturu" };

    async function sync() {
        try {
            const m = await db.collection('config').doc('master').get();
            if(m.exists) ADMIN_SECRET = m.data().key;
            const l = await db.collection('config').doc('login').get();
            if(l.exists) loginData = l.data();
        } catch(e) { console.log("Sync Error", e); }
    }

    async function login() {
        await sync(); // Force sync before checking
        const u = document.getElementById('username').value.trim();
        const p = document.getElementById('password').value.trim();
        if(u === loginData.user && p === loginData.pass) {
            localStorage.setItem('loveLogin', 'yes');
            localStorage.setItem('loveUser', u);
            location.reload();
        } else {
            alert("Invalid Login Credentials.");
        }
    }

    if(localStorage.getItem('loveLogin') === 'yes') {
        document.getElementById('loginSection').classList.add('hidden');
        document.getElementById('appSection').classList.remove('hidden');
        document.getElementById('timerContainer').classList.remove('hidden');
        document.getElementById('navTrigger').classList.remove('hidden');
        sync(); loadMemories(); listenChat(); loadSketches();
        db.collection('games').doc('ttt').onSnapshot(doc => {
            if(doc.exists) {
                const b = doc.data().board;
                document.querySelectorAll('.game-cell').forEach((c, i) => c.innerText = b[i]);
            }
        });
    }

    // Timer Logic
    setInterval(() => {
        const diff = new Date() - new Date("2025-02-13T11:14:00");
        const d = Math.floor(diff/86400000), h = Math.floor((diff%86400000)/3600000), m = Math.floor((diff%3600000)/60000), s = Math.floor((diff%60000)/1000);
        document.getElementById('loveCounter').innerText = `${d} Days ${h} Hours ${m} Minutes ${s} Seconds`;
    }, 1000);

    // Mood Logic 
    let selMood = "";
    function selectEmoji(e, el) { 
        selMood = e; 
        document.querySelectorAll('.emoji-box').forEach(b => b.classList.remove('selected')); 
        el.classList.add('selected'); 
    }
    async function saveMood() { 
        if(!selMood) return alert("Select an emoji!"); 
        await db.collection('moods').add({ emoji: selMood, note: document.getElementById('moodNote').value, time: Date.now() }); 
        document.getElementById('moodNote').value = ""; 
        loadMoods(); 
    }
    async function loadMoods() { 
        const disp = document.getElementById('moodDisplay'); 
        const snap = await db.collection('moods').orderBy('time', 'desc').get(); 
        disp.innerHTML = "<h4>Vibes Log:</h4>"; 
        snap.forEach(doc => { 
            const data = doc.data();
            disp.innerHTML += `<div class="mood-log-item">
                <span><strong>${data.emoji}</strong> ${data.note || ''}</span>
                <button onclick="delMood('${doc.id}')" style="background:none; border:none; color:red; cursor:pointer;">‚úï</button>
            </div>`; 
        }); 
    }
    async function delMood(id) { if(prompt("Master Key:") === ADMIN_SECRET) { await db.collection('moods').doc(id).delete(); loadMoods(); } }

    // Drawing Pad
    const canvas = document.getElementById('canvasBox'); const ctx = canvas.getContext('2d');
    const colorPicker = document.getElementById('strokeColor');
    let drawing = false;
    function initCanvas() { canvas.width = canvas.offsetWidth; canvas.height = canvas.offsetHeight; ctx.lineCap = "round"; ctx.lineWidth = 4; }
    const getPos = (e) => { const r = canvas.getBoundingClientRect(); const cx = e.touches ? e.touches[0].clientX : e.clientX; const cy = e.touches ? e.touches[0].clientY : e.clientY; return { x: cx-r.left, y: cy-r.top }; }
    ['mousedown','touchstart'].forEach(ev => canvas.addEventListener(ev, e => { drawing=true; ctx.beginPath(); const p=getPos(e); ctx.moveTo(p.x, p.y); }));
    ['mousemove','touchmove'].forEach(ev => canvas.addEventListener(ev, e => { if(!drawing) return; const p=getPos(e); ctx.strokeStyle = colorPicker.value; ctx.lineTo(p.x, p.y); ctx.stroke(); e.preventDefault(); }));
    ['mouseup','touchend'].forEach(ev => canvas.addEventListener(ev, () => drawing=false));
    function clearCanvas() { ctx.clearRect(0,0,canvas.width,canvas.height); }
    async function saveDrawing() { await db.collection('sketches').add({ img: canvas.toDataURL(), time: Date.now() }); loadSketches(); clearCanvas(); }
    async function loadSketches() {
        const gal = document.getElementById('sketchGallery'); gal.innerHTML = "";
        const snap = await db.collection('sketches').orderBy('time', 'desc').get();
        snap.forEach(doc => { gal.innerHTML += `<div style="position:relative;"><img src="${doc.data().img}" style="width:100%; border-radius:15px; border:1px solid #eee;"><span onclick="delSketch('${doc.id}')" style="position:absolute; top:5px; right:5px; background:white; border-radius:50%; width:22px; height:22px; display:flex; align-items:center; justify-content:center; cursor:pointer; font-size:0.7rem;">‚úï</span></div>`; });
    }
    async function delSketch(id) { if(confirm("Delete sketch?")) await db.collection('sketches').doc(id).delete(); loadSketches(); }

    // Memories logic
    async function loadMemories() {
        const grid = document.getElementById('memoryGrid');
        const snap = await db.collection('memories').orderBy('time', 'desc').get();
        grid.innerHTML = "";
        snap.forEach(doc => {
            const m = doc.data();
            const d = new Date(m.time).toLocaleDateString('en-GB');
            grid.innerHTML += `<div class="memory-item"><img src="${m.img}"><div class="memory-content"><p>${m.text}</p><div style="font-size:0.7rem; color:#aaa;">${d}</div><div style="display:flex; gap:10px; margin-top:10px;"><button class="btn" style="flex:1; font-size:0.7rem; background:#eee;" onclick="editMem('${doc.id}','${m.text}')">Edit</button><button class="btn" style="flex:1; color:red; font-size:0.7rem; background:#fff0f3;" onclick="delMem('${doc.id}')">Delete</button></div></div></div>`;
        });
    }

    // Chat logic
    function listenChat() {
        db.collection('chats').orderBy('time', 'asc').onSnapshot(snap => {
            const disp = document.getElementById('chatDisplay'); disp.innerHTML = "";
            snap.forEach(doc => {
                const isMe = doc.data().user === localStorage.getItem('loveUser');
                disp.innerHTML += `<div class="msg-wrap ${isMe?'sent-wrap':''}">
                    <div class="msg ${isMe?'msg-sent':'msg-rec'}">${doc.data().text}</div>
                    <span style="color:#ff4d6d; cursor:pointer; font-size:0.7rem;" onclick="deleteChat('${doc.id}')">‚úï</span>
                </div>`;
            });
            disp.scrollTop = disp.scrollHeight;
        });
    }
    async function sendChat() { const inp = document.getElementById('chatInput'); if(inp.value.trim()){ await db.collection('chats').add({ user: localStorage.getItem('loveUser'), text: inp.value, time: Date.now() }); inp.value = ""; } }
    async function deleteChat(id) { if(confirm("Delete?")) await db.collection('chats').doc(id).delete(); }

    async function playOnlineTTT(i) { const snap = await db.collection('games').doc('ttt').get(); let b = snap.exists ? snap.data().board : Array(9).fill(""); if(b[i]) return; b[i] = localStorage.getItem('loveUser') === 'turuturu' ? 'X' : 'O'; await db.collection('games').doc('ttt').set({ board: b }); }
    async function resetOnlineTTT() { await db.collection('games').doc('ttt').set({ board: Array(9).fill("") }); }
    async function handleSave() { const file = document.getElementById('photoInput').files[0]; const text = document.getElementById('memoryText').value; if(!file || !text) return alert("Info missing!"); const r = new FileReader(); r.readAsDataURL(file); r.onload = async (e) => { await db.collection('memories').add({ text, img: e.target.result, time: Date.now() }); location.reload(); }; }
    async function delMem(id) { if(prompt("Master Key:") === ADMIN_SECRET) { await db.collection('memories').doc(id).delete(); loadMemories(); } }
    async function editMem(id, cur) { const nt = prompt("Edit:", cur); if(nt) await db.collection('memories').doc(id).update({ text: nt }); loadMemories(); }
    function forgetPass() { if(prompt("Master Key:") === ADMIN_SECRET) alert(`User: ${loginData.user}\nPass: ${loginData.pass}`); }
    async function updateLogin() { if(document.getElementById('authMK').value === ADMIN_SECRET) { await db.collection('config').doc('login').set({ user: document.getElementById('setNewU').value, pass: document.getElementById('setNewP').value }); logout(); } }
    async function updateMaster() { if(document.getElementById('oldMK').value === ADMIN_SECRET) { await db.collection('config').doc('master').set({ key: document.getElementById('newMK').value }); location.reload(); } }
    function logout() { localStorage.clear(); location.reload(); }
    function toggleMenu(s) { document.getElementById('sideMenu').classList.toggle('active', s); document.getElementById('overlay').style.display = s ? 'block' : 'none'; }
    function showSection(id) { document.querySelectorAll('.section').forEach(s => s.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); if(id==='drawTab') setTimeout(initCanvas,100); if(id==='moodTab') loadMoods(); toggleMenu(false); }
</script>
</body>
</html>
